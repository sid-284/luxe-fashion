<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Credentials Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ CORS Credentials Test</h1>
        <p>This page tests CORS configuration with credentials for the Luxe Fashion backend.</p>
        
        <div class="test-section info">
            <h3>üìã Test Configuration</h3>
            <p><strong>Backend URL:</strong> <span id="backend-url">http://localhost:8000</span></p>
            <p><strong>Current Origin:</strong> <span id="current-origin"></span></p>
            <p><strong>Credentials:</strong> include</p>
        </div>

        <div class="test-section">
            <h3>üîß Test Controls</h3>
            <button onclick="testHealthCheck()">Test Health Check</button>
            <button onclick="testAdminLogin()">Test Admin Login</button>
            <button onclick="testWithAuth()">Test With Auth Header</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>

        <div class="test-section">
            <h3>üìä Test Results</h3>
            <div id="log" class="log">Click a test button to start testing...\n</div>
        </div>

        <div class="test-section info">
            <h3>‚úÖ What to Look For</h3>
            <ul>
                <li><strong>Access-Control-Allow-Origin:</strong> Should match current origin exactly</li>
                <li><strong>Access-Control-Allow-Credentials:</strong> Should be "true"</li>
                <li><strong>Set-Cookie:</strong> Should be present in login responses</li>
                <li><strong>No CORS errors:</strong> Check browser console for CORS errors</li>
            </ul>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:8000';
        
        // Display current origin
        document.getElementById('current-origin').textContent = window.location.origin;
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
        }
        
        async function testHealthCheck() {
            log('üîç Testing health check endpoint...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                log(`Status: ${response.status}`);
                log(`Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}`);
                log(`Access-Control-Allow-Credentials: ${response.headers.get('Access-Control-Allow-Credentials')}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Health check successful: ${data.status}`);
                } else {
                    log(`‚ùå Health check failed: ${response.statusText}`);
                }
            } catch (error) {
                log(`‚ùå Health check error: ${error.message}`);
            }
            log('---');
        }
        
        async function testAdminLogin() {
            log('üîê Testing admin login endpoint...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/auth/adminlogin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'testpassword'
                    })
                });
                
                log(`Status: ${response.status}`);
                log(`Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}`);
                log(`Access-Control-Allow-Credentials: ${response.headers.get('Access-Control-Allow-Credentials')}`);
                log(`Set-Cookie: ${response.headers.get('Set-Cookie') ? 'Present' : 'Not present'}`);
                
                const data = await response.json();
                log(`Response: ${JSON.stringify(data, null, 2)}`);
                
                if (response.headers.get('Access-Control-Allow-Credentials') === 'true') {
                    log('‚úÖ Credentials properly configured');
                } else {
                    log('‚ùå Credentials not properly configured');
                }
            } catch (error) {
                log(`‚ùå Admin login error: ${error.message}`);
            }
            log('---');
        }
        
        async function testWithAuth() {
            log('üîë Testing with Authorization header...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/user/getadmin`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer test-token'
                    },
                    credentials: 'include'
                });
                
                log(`Status: ${response.status}`);
                log(`Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}`);
                log(`Access-Control-Allow-Credentials: ${response.headers.get('Access-Control-Allow-Credentials')}`);
                
                const data = await response.json();
                log(`Response: ${JSON.stringify(data, null, 2)}`);
                
                if (response.status === 401) {
                    log('‚úÖ Unauthorized as expected (token is invalid)');
                } else {
                    log('‚ÑπÔ∏è Unexpected response (check if this is correct)');
                }
            } catch (error) {
                log(`‚ùå Auth test error: ${error.message}`);
            }
            log('---');
        }
        
        // Log initial information
        log('üöÄ CORS Credentials Test Page Loaded');
        log(`Current origin: ${window.location.origin}`);
        log(`Backend URL: ${BACKEND_URL}`);
        log('Ready to test! Click a button above to start.');
        log('---');
    </script>
</body>
</html>
